function demo(){var a=Object.freeze({Valid:1,Invalid:2,Processing:3}),b={input:{expression:"",tensorOrders:{}},output:{computeLoops:"",assemblyLoops:"",fullCode:""},error:"",state:a.Valid,inputViews:[],outputViews:[],stateViews:[],addInputView:function(a){b.inputViews.push(a),a(400)},updateInputViews:function(){for(v in b.inputViews)b.inputViews[v](400)},addOutputView:function(a){b.outputViews.push(a),a(0)},updateOutputViews:function(){for(v in b.outputViews)b.outputViews[v](0)},addStateView:function(a){b.stateViews.push(a),a(0)},updateStateViews:function(){for(v in b.stateViews)b.stateViews[v](0)},setInput:function(c){if(b.input.expression=c,b.input.expression.length>256)b.input.tensorOrders={},b.error="Input expression is too long";else try{b.input.tensorOrders=parser.parse(c),b.error="";for(t in b.input.tensorOrders)if(b.input.tensorOrders[t]<0){b.input.tensorOrders={},b.error="Tensor "+t+" has inconsistent order";break}}catch(a){b.input.tensorOrders={},b.error="Input expression is invalid"}b.setState(""===b.error?a.Valid:a.Invalid),b.updateInputViews()},setOutput:function(a,c,d,e,f){b.output={computeLoops:a,assemblyLoops:c,fullCode:d},b.error=e,b.setState(f),b.updateOutputViews()},setState:function(a){b.state=a,b.updateStateViews()}},c={timerEvent:null,updateView:function(a){if(clearTimeout(c.timerEvent),""!==b.error){var d=function(){$("#lblError").html(b.error),$("#txtExpr").parent().addClass("is-invalid")};c.timerEvent=setTimeout(d,a)}else $("#txtExpr").parent().removeClass("is-invalid")}},d={cache:{},timerEvent:null,createCacheEntry:function(a){for(var b=$("#"+a).sortable("toArray"),c=[],d=[],e=1;e<b.length;++e)c.push($("#"+b[e]+"_select").attr("data-val")),d.push(parseInt(b[e].split("_")[1]));return{formats:c,ordering:d}},getFormatString:function(a){switch(a){case"d":return"Dense";case"s":return"Sparse";default:return""}},updateView:function(a){if(clearTimeout(d.timerEvent),""!==b.error){var c=function(){$("#tblFormats").hide()};d.timerEvent=setTimeout(c,400)}else{var e="";for(t in b.input.tensorOrders){var f=b.input.tensorOrders[t],g=d.cache.hasOwnProperty(t)&&d.cache[t].formats.length==f;if(f>0){var h="dims"+t;e+="<tr>",e+='<td class="mdl-data-table__cell--non-numeric" ',e+='width="100"><div align="center" style="font-size: 16px">',e+=t,e+="</div></td>",e+='<td class="mdl-data-table__cell--non-numeric" ',e+='style="padding: 0px">',e+='<ul id="',e+=h,e+='" class="ui-state-default sortable">',e+='<li class="ui-state-default" ',e+='style="width: 0px; padding: 0px"></li>';for(var i=0;i<f;++i){var j=g?d.cache[t].ordering[i]:i,k=g?d.cache[t].formats[i]:"d",l="dim"+t+"_"+j,m=l+"_select";e+='<li id="',e+=l,e+='" class="ui-state-default">',e+='<div class="mdl-textfield mdl-js-textfield ',e+='mdl-textfield--floating-label getmdl-select">',e+='<input class="mdl-textfield__input ',e+='format-input" id="',e+=m,e+='" type="text" readonly ',e+='value="',e+=d.getFormatString(k),e+='" data-val="',e+=k,e+='"/>',e+='<label for="',e+=m,e+='">',e+='<i class="mdl-icon-toggle__label ',e+='material-icons">keyboard_arrow_down</i>',e+="</label>",e+='<label class="mdl-textfield__label" for="',e+=m,e+='">Dimension ',e+=j+1,e+="</label>",e+='<ul class="mdl-menu mdl-menu--bottom-left ',e+='mdl-js-menu" for="',e+=m,e+='">',e+='<li class="mdl-menu__item" data-val="',e+='d">Dense</li>',e+='<li class="mdl-menu__item" data-val="',e+='s">Sparse</li>',e+="</ul></div></li>"}e+="</ul></td></tr>"}}if(""!==e){$("#listTensors").html(e),getmdlSelect.init(".getmdl-select"),$(".sortable").sortable({update:function(a,b){var c=b.item.parent().attr("id"),e=c.replace("dims","");d.cache[e]=d.createCacheEntry(c)}}),$(".format-input").change(function(){var a=$(this).parent().parent().parent().attr("id"),b=a.replace("dims","");d.cache[b]=d.createCacheEntry(a)});for(t in b.input.tensorOrders)b.input.tensorOrders[t]>0&&(d.cache[t]=d.createCacheEntry("dims"+t));$("#tblFormats").show()}else $("#tblFormats").hide()}}};b.addInputView(c.updateView),b.addInputView(d.updateView),$("#txtExpr").keyup(function(){b.setInput($("#txtExpr").val())});var e={updateView:function(a){var c=""===b.output.computeLoops?"/* The generated compute loops will appear here */":b.output.computeLoops.replace(/</g,"&lt;"),d=""===b.output.assemblyLoops?"/* The generated assembly loops will appear here */":b.output.assemblyLoops.replace(/</g,"&lt;"),e=""===b.output.fullCode?"/* The complete generated code will appear here */":b.output.fullCode.replace(/</g,"&lt;");$("#txtComputeLoops").html(c),$("#txtAssemblyLoops").html(d),$("#txtFullCode").html(e),$("pre code").each(function(a,b){hljs.highlightBlock(b)})}},f={updateView:function(a){""===b.output.fullCode?($("#btnDownload").hide(),$("#btnDownload").parent().css("width","0px")):($("#btnDownload").show(),$("#btnDownload").parent().css("width","180px"))}};b.addOutputView(c.updateView),b.addOutputView(e.updateView),b.addOutputView(f.updateView),$("#btnDownload").click(function(){var a=new Blob([b.output.fullCode],{type:"text/plain;charset=utf-8"});saveAs(a,"taco_kernel.c")});var g={updateView:function(c){$("#btnGetKernel").prop("disabled",b.state!==a.Valid),$("#btnGetKernel").html(b.state===a.Processing?"Processing...":"Generate Kernel")}};b.addStateView(g.updateView),$("#btnGetKernel").click(function(){b.setOutput("","","","",a.Processing);var c=b.input.expression.replace(/ /g,"");for(t in b.input.tensorOrders){var d=b.input.tensorOrders[t];if(0!=d){c+=" -f="+t+":";for(var e=$("#dims"+t).sortable("toArray"),f=1;f<=d;++f)c+=$("#"+e[f]+"_select").attr("data-val");c+=":";for(var f=1;f<=d;++f)c+=e[f].split("_")[1],c+=f===d?"":","}}$.ajax({type:"POST",url:"http://tensor-compiler-online.csail.mit.edu",data:escape(c),async:!0,cache:!1,success:function(c){b.setOutput(c["compute-kernel"],c["assembly-kernel"],c["full-kernel"],c.error,a.Valid)},error:function(c,d,e){b.setOutput("","","","Unable to connect to the taco online server",a.Valid)}})});for(var h=[{name:"Matrix-vector multiplication",code:"y(i) = A(i,j) * x(j)"},{name:"Matrix addition",code:"A(i,j) = B(i,j) + C(i,j)"},{name:"Tensor-times-vector",code:"A(i,j) = B(i,j,k) * c(k)"},{name:"MTTKRP",code:"A(i,j) = B(i,k,l) * C(k,j) * D(l,j)"}],i="",j=0;j<h.length;++j)i+='<li id="example',i+=j,i+='" class="mdl-menu__item">',i+=h[j].name,i+=":&nbsp; <code>",i+=h[j].code,i+="</code></li>";$("#listExamples").html(i);for(var j=0;j<h.length;++j)!function(a){$("#example"+j).click(function(){$("#txtExpr").val(a),b.setInput(a)})}(h[j].code);b.setInput("y(i) = A(i,j) * x(j)"),hljs.initHighlightingOnLoad()}var saveAs=saveAs||function(a){"use strict";if(!(void 0===a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var r,o=this,p=b.type,q=p===j,s=function(){m(o,"writestart progress write writeend".split(" "))},t=function(){if((h||q&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;");a.open(b,"_blank")||(a.location.href=b),b=void 0,o.readyState=o.DONE,s()},d.readAsDataURL(b),void(o.readyState=o.INIT)}if(r||(r=c().createObjectURL(b)),q)a.location.href=r;else{a.open(r,"_blank")||(a.location.href=r)}o.readyState=o.DONE,s(),l(r)};if(o.readyState=o.INIT,e)return r=c().createObjectURL(b),void setTimeout(function(){d.href=r,d.download=i,f(d),s(),l(r),o.readyState=o.DONE});t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs}),parser=function(){"use strict";function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,c,d,e){this.message=a,this.expected=c,this.found=d,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,b)}function c(a,c){function ca(){return a.substring(Y,X)}function ga(a,b){return{type:"literal",text:a,ignoreCase:b}}function ha(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function ja(){return{type:"end"}}function ka(a){return{type:"other",description:a}}function la(b){var d,c=Z[b];if(c)return c;for(d=b-1;!Z[d];)d--;for(c=Z[d],c={line:c.line,column:c.column};d<b;)10===a.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;return Z[b]=c,c}function ma(a,b){var c=la(a),d=la(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function na(a){X<$||(X>$&&($=X,_=[]),_.push(a))}function pa(a,c,d){return new b(b.buildMessage(a,c),a,c,d)}function qa(){var b,c,e,f,j,k,l,m;return b=X,c=Da(),c!==d?(e=wa(),e!==d?(f=Da(),f!==d?(61===a.charCodeAt(X)?(j=g,X++):(j=d,0===aa&&na(h)),j!==d?(k=Da(),k!==d?(l=ra(),l!==d?(m=Da(),m!==d?(Y=b,c=i(e,l),b=c):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d),b}function ra(){var b,c,e,f,g,h,i,o;if(b=X,(c=sa())!==d){for(e=[],f=X,g=Da(),g!==d?(43===a.charCodeAt(X)?(h=j,X++):(h=d,0===aa&&na(k)),h===d&&(45===a.charCodeAt(X)?(h=l,X++):(h=d,0===aa&&na(m))),h!==d?(i=Da(),i!==d?(o=sa(),o!==d?(g=[g,h,i,o],f=g):(X=f,f=d)):(X=f,f=d)):(X=f,f=d)):(X=f,f=d);f!==d;)e.push(f),f=X,g=Da(),g!==d?(43===a.charCodeAt(X)?(h=j,X++):(h=d,0===aa&&na(k)),h===d&&(45===a.charCodeAt(X)?(h=l,X++):(h=d,0===aa&&na(m))),h!==d?(i=Da(),i!==d?(o=sa(),o!==d?(g=[g,h,i,o],f=g):(X=f,f=d)):(X=f,f=d)):(X=f,f=d)):(X=f,f=d);e!==d?(Y=b,c=n(c,e),b=c):(X=b,b=d)}else X=b,b=d;return b}function sa(){var b,c,e,f,g,h,i,j;if(b=X,(c=ta())!==d){for(e=[],f=X,g=Da(),g!==d?(42===a.charCodeAt(X)?(h=o,X++):(h=d,0===aa&&na(p)),h===d&&(47===a.charCodeAt(X)?(h=q,X++):(h=d,0===aa&&na(r))),h!==d?(i=Da(),i!==d?(j=ta(),j!==d?(g=[g,h,i,j],f=g):(X=f,f=d)):(X=f,f=d)):(X=f,f=d)):(X=f,f=d);f!==d;)e.push(f),f=X,g=Da(),g!==d?(42===a.charCodeAt(X)?(h=o,X++):(h=d,0===aa&&na(p)),h===d&&(47===a.charCodeAt(X)?(h=q,X++):(h=d,0===aa&&na(r))),h!==d?(i=Da(),i!==d?(j=ta(),j!==d?(g=[g,h,i,j],f=g):(X=f,f=d)):(X=f,f=d)):(X=f,f=d)):(X=f,f=d);e!==d?(Y=b,c=s(c,e),b=c):(X=b,b=d)}else X=b,b=d;return b}function ta(){var a,b;return a=X,b=ua(),b===d&&(b=va())===d&&(b=wa())===d&&(b=Ca()),b!==d&&(Y=a,b=t(b)),a=b}function ua(){var b,c,e,f,g,h;return b=X,40===a.charCodeAt(X)?(c=u,X++):(c=d,0===aa&&na(v)),c!==d?(e=Da(),e!==d?(f=ra(),f!==d?(g=Da(),g!==d?(41===a.charCodeAt(X)?(h=w,X++):(h=d,0===aa&&na(x)),h!==d?(Y=b,c=t(f),b=c):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d),b}function va(){var b,c,e;return b=X,45===a.charCodeAt(X)?(c=l,X++):(c=d,0===aa&&na(m)),c!==d?(e=ta(),e!==d?(Y=b,c=t(e),b=c):(X=b,b=d)):(X=b,b=d),b}function wa(){var a,b,c;return a=X,b=Ba(),b!==d?(c=xa(),c===d&&(c=ya())===d&&(c=za())===d&&(c=Da()),c!==d?(Y=a,b=y(b,c),a=b):(X=a,a=d)):(X=a,a=d),a}function xa(){var b,c,e;return b=X,95===a.charCodeAt(X)?(c=z,X++):(c=d,0===aa&&na(A)),c!==d?(e=Ba(),e!==d?(Y=b,c=B(),b=c):(X=b,b=d)):(X=b,b=d),b}function ya(){var b,c,e,f,g;return b=X,95===a.charCodeAt(X)?(c=z,X++):(c=d,0===aa&&na(A)),c!==d?(123===a.charCodeAt(X)?(e=C,X++):(e=d,0===aa&&na(D)),e!==d?(f=Aa(),f!==d?(125===a.charCodeAt(X)?(g=E,X++):(g=d,0===aa&&na(F)),g!==d?(Y=b,c=G(f),b=c):(X=b,b=d)):(X=b,b=d)):(X=b,b=d)):(X=b,b=d),b}function za(){var b,c,e,f;return b=X,40===a.charCodeAt(X)?(c=u,X++):(c=d,0===aa&&na(v)),c!==d?(e=Aa(),e!==d?(41===a.charCodeAt(X)?(f=w,X++):(f=d,0===aa&&na(x)),f!==d?(Y=b,c=G(e),b=c):(X=b,b=d)):(X=b,b=d)):(X=b,b=d),b}function Aa(){var b,c,e,f,g,h;if(b=X,(c=Ba())!==d){for(e=[],f=X,44===a.charCodeAt(X)?(g=H,X++):(g=d,0===aa&&na(I)),g!==d?(h=Ba(),h!==d?(g=[g,h],f=g):(X=f,f=d)):(X=f,f=d);f!==d;)e.push(f),f=X,44===a.charCodeAt(X)?(g=H,X++):(g=d,0===aa&&na(I)),g!==d?(h=Ba(),h!==d?(g=[g,h],f=g):(X=f,f=d)):(X=f,f=d);e!==d?(Y=b,c=J(c,e),b=c):(X=b,b=d)}else X=b,b=d;return b}function Ba(){var b,c,e,f;if(b=X,K.test(a.charAt(X))?(c=a.charAt(X),X++):(c=d,0===aa&&na(L)),c!==d){for(e=[],M.test(a.charAt(X))?(f=a.charAt(X),X++):(f=d,0===aa&&na(N));f!==d;)e.push(f),M.test(a.charAt(X))?(f=a.charAt(X),X++):(f=d,0===aa&&na(N));e!==d?(Y=b,c=O(),b=c):(X=b,b=d)}else X=b,b=d;return b}function Ca(){var b,c,e,f,g,h;if(b=X,c=[],P.test(a.charAt(X))?(e=a.charAt(X),X++):(e=d,0===aa&&na(Q)),e!==d)for(;e!==d;)c.push(e),P.test(a.charAt(X))?(e=a.charAt(X),X++):(e=d,0===aa&&na(Q));else c=d;if(c!==d){if(e=X,46===a.charCodeAt(X)?(f=R,X++):(f=d,0===aa&&na(S)),f!==d){for(g=[],P.test(a.charAt(X))?(h=a.charAt(X),X++):(h=d,0===aa&&na(Q));h!==d;)g.push(h),P.test(a.charAt(X))?(h=a.charAt(X),X++):(h=d,0===aa&&na(Q));g!==d?(f=[f,g],e=f):(X=e,e=d)}else X=e,e=d;e===d&&(e=null),e!==d?(Y=b,c=T(),b=c):(X=b,b=d)}else X=b,b=d;return b}function Da(){var b,c,e;for(b=X,c=[],U.test(a.charAt(X))?(e=a.charAt(X),X++):(e=d,0===aa&&na(V));e!==d;)c.push(e),U.test(a.charAt(X))?(e=a.charAt(X),X++):(e=d,0===aa&&na(V));return c!==d&&(Y=b,c=W()),b=c}c=void 0!==c?c:{};var ba,d={},e={Assign:qa},f=qa,g="=",h=ga("=",!1),i=function(a,b){var c=a;for(var d in b)c[d]=c.hasOwnProperty(d)&&c[d]!==b[d]?-1:b[d];return a},j="+",k=ga("+",!1),l="-",m=ga("-",!1),n=function(a,b){for(var c=a,d=0;d<b.length;++d){var e=b[d][3];for(var f in e)c[f]=c.hasOwnProperty(f)&&c[f]!==e[f]?-1:e[f]}return c},o="*",p=ga("*",!1),q="/",r=ga("/",!1),s=function(a,b){for(var c=a,d=0;d<b.length;++d){var e=b[d][3];for(var f in e)c[f]=c.hasOwnProperty(f)&&c[f]!==e[f]?-1:e[f]}return c},t=function(a){return a},u="(",v=ga("(",!1),w=")",x=ga(")",!1),y=function(a,b){var c={};return c[a]=b,c},z="_",A=ga("_",!1),B=function(){return 1},C="{",D=ga("{",!1),E="}",F=ga("}",!1),G=function(a){return a},H=",",I=ga(",",!1),J=function(a,b){return 1+b.length},K=/^[a-z]/i,L=ha([["a","z"]],!1,!0),M=/^[a-z\/0-9]/i,N=ha([["a","z"],"/",["0","9"]],!1,!0),O=function(){return ca()},P=/^[0-9]/,Q=ha([["0","9"]],!1,!1),R=".",S=ga(".",!1),T=function(){return{}},U=/^[ \t\n\r]/,V=ha([" ","\t","\n","\r"],!1,!1),W=function(){return 0},X=0,Y=0,Z=[{line:1,column:1}],$=0,_=[],aa=0;if("startRule"in c){if(!(c.startRule in e))throw new Error("Can't start parsing from rule \""+c.startRule+'".');f=e[c.startRule]}if((ba=f())!==d&&X===a.length)return ba;throw ba!==d&&X<a.length&&na(ja()),pa(_,$<a.length?a.charAt($):null,$<a.length?ma($,$+1):ma($,$))}return a(b,Error),b.buildMessage=function(a,b){function d(a){return a.charCodeAt(0).toString(16).toUpperCase()}function e(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+d(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+d(a)})}function f(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+d(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+d(a)})}function g(a){return c[a.type](a)}function h(a){var c,d,b=new Array(a.length);for(c=0;c<a.length;c++)b[c]=g(a[c]);if(b.sort(),b.length>0){for(c=1,d=1;c<b.length;c++)b[c-1]!==b[c]&&(b[d]=b[c],d++);b.length=d}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function i(a){return a?'"'+e(a)+'"':"end of input"}var c={literal:function(a){return'"'+e(a.text)+'"'},class:function(a){var c,b="";for(c=0;c<a.parts.length;c++)b+=a.parts[c]instanceof Array?f(a.parts[c][0])+"-"+f(a.parts[c][1]):f(a.parts[c]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+h(a)+" but "+i(b)+" found."},{SyntaxError:b,parse:c}}();